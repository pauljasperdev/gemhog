---
phase: 01.1-test-file-convention-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/db/src/connection.int.test.ts
  - apps/web/tests/e2e/home.e2e.test.ts
  - vitest.config.ts
  - vitest.integration.config.ts
  - playwright.config.ts
  - packages/db/vitest.config.ts
  - .planning/codebase/TESTING.md
  - .planning/STATE.md
autonomous: true

must_haves:
  truths:
    - "Unit tests discovered via *.test.ts pattern"
    - "Integration tests discovered via *.int.test.ts pattern"
    - "E2E tests discovered via *.e2e.test.ts pattern"
    - "pnpm test:unit finds 1 test file"
    - "pnpm test:integration finds 1 test file"
    - "pnpm test:e2e finds 1 test file"
  artifacts:
    - path: "packages/db/src/connection.int.test.ts"
      provides: "Integration test with new naming convention"
    - path: "apps/web/tests/e2e/home.e2e.test.ts"
      provides: "E2E test with new naming convention"
    - path: "vitest.config.ts"
      provides: "Unit test config excluding *.int.test.ts"
      contains: "**/*.int.test.ts"
    - path: "vitest.integration.config.ts"
      provides: "Integration test config including *.int.test.ts"
      contains: "*.int.test.ts"
    - path: "playwright.config.ts"
      provides: "E2E config with explicit testMatch"
      contains: "testMatch"
    - path: "packages/db/vitest.config.ts"
      provides: "Package config excluding *.int.test.ts"
      contains: "**/*.int.test.ts"
  key_links:
    - from: "vitest.config.ts"
      to: "packages/api/src/example.test.ts"
      via: "*.test.ts include pattern"
      pattern: "projects.*apps.*packages"
    - from: "vitest.integration.config.ts"
      to: "packages/db/src/connection.int.test.ts"
      via: "*.int.test.ts include pattern"
      pattern: "int\\.test\\.ts"
    - from: "playwright.config.ts"
      to: "apps/web/tests/e2e/home.e2e.test.ts"
      via: "testMatch pattern"
      pattern: "e2e\\.test\\.ts"
---

<objective>
Migrate test file naming convention from the current mixed convention to a consistent standard:
- Unit tests: `*.test.ts` (unchanged)
- Integration tests: `*.integration.test.ts` -> `*.int.test.ts`
- E2E tests: `*.spec.ts` -> `*.e2e.test.ts`

Purpose: Standardize naming for clarity and consistency across all test types.
Output: Renamed test files, updated configs, updated documentation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01.1-test-file-convention-migration/01.1-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename test files and update configs</name>
  <files>
    packages/db/src/connection.integration.test.ts -> packages/db/src/connection.int.test.ts
    apps/web/tests/e2e/home.spec.ts -> apps/web/tests/e2e/home.e2e.test.ts
    vitest.config.ts
    vitest.integration.config.ts
    playwright.config.ts
    packages/db/vitest.config.ts
  </files>
  <action>
    1. Rename test files using git mv (preserves history):
       - `git mv packages/db/src/connection.integration.test.ts packages/db/src/connection.int.test.ts`
       - `git mv apps/web/tests/e2e/home.spec.ts apps/web/tests/e2e/home.e2e.test.ts`

    2. Update vitest.config.ts (root):
       - Line 10: Change `"**/*.integration.test.ts"` to `"**/*.int.test.ts"`
       - Line 22: Change `"**/*.integration.test.ts"` to `"**/*.int.test.ts"`
       - Keep `"**/*.spec.ts"` in coverage exclude (no longer exists but harmless)

    3. Update vitest.integration.config.ts:
       - Lines 11-12: Change `*.integration.test.ts` to `*.int.test.ts` in both include patterns

    4. Update playwright.config.ts:
       - Add after line 5 (testDir): `testMatch: "**/*.e2e.test.ts",`

    5. Update packages/db/vitest.config.ts:
       - Line 9: Change `["**/*.integration.test.ts"]` to `["**/*.int.test.ts"]`

    IMPORTANT: All changes must be atomic. Do NOT partially complete - either all configs match new patterns or rollback.
  </action>
  <verify>
    Run all three test commands to verify discovery:
    - `pnpm test:unit --run` should find packages/api/src/example.test.ts (1 test)
    - `pnpm test:integration --run` should find packages/db/src/connection.int.test.ts (requires Docker)
    - `pnpm test:e2e --list` should show home.e2e.test.ts file
  </verify>
  <done>
    - Test files renamed with git mv
    - All 4 config files updated with new glob patterns
    - pnpm test:unit finds unit tests
    - pnpm test:integration finds integration tests (if Docker available)
    - pnpm test:e2e recognizes e2e test files
  </done>
</task>

<task type="auto">
  <name>Task 2: Update documentation</name>
  <files>
    .planning/codebase/TESTING.md
    .planning/STATE.md
  </files>
  <action>
    1. Update TESTING.md:
       - Line 78: Change `*.integration.test.ts` to `*.int.test.ts`
       - Line 83: Change `*.spec.ts` to `*.e2e.test.ts`
       - Line 97: Change `*.integration.test.ts` to `*.int.test.ts`
       - Line 98: Change `*.spec.ts` to `*.e2e.test.ts`
       - Lines 106-107: Change example filenames to use `.int.test.ts`
       - Line 116: Change pattern description to `*.int.test.ts`
       - Lines 120-122: Update glob patterns to `*.int.test.ts`

    2. Update STATE.md:
       - Lines 102-104: Update Test File Convention section:
         - `*.integration.test.ts` -> `*.int.test.ts`
         - `*.spec.ts` -> `*.e2e.test.ts`
       - Update Decision table (around line 62): Change decision text about integration test suffix from `*.integration.test.ts` to `*.int.test.ts`

    Ensure documentation accurately reflects the new convention after migration.
  </action>
  <verify>
    - `grep -r "integration.test.ts" .planning/` returns no matches (old pattern removed)
    - `grep -r "\.spec\.ts" .planning/codebase/TESTING.md` returns no matches (old E2E pattern removed)
    - `grep "int.test.ts" .planning/codebase/TESTING.md` returns matches (new pattern present)
    - `grep "e2e.test.ts" .planning/codebase/TESTING.md` returns matches (new pattern present)
  </verify>
  <done>
    - TESTING.md reflects new naming convention throughout
    - STATE.md reflects new naming convention
    - No references to old patterns remain in planning docs
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Test discovery verification:
   ```bash
   pnpm test:unit --run    # Should pass, find example.test.ts
   ```

2. File existence check:
   ```bash
   ls packages/db/src/connection.int.test.ts
   ls apps/web/tests/e2e/home.e2e.test.ts
   ```

3. Old files should NOT exist:
   ```bash
   ls packages/db/src/connection.integration.test.ts  # Should fail (not found)
   ls apps/web/tests/e2e/home.spec.ts                 # Should fail (not found)
   ```

4. Documentation check:
   ```bash
   grep -c "int.test.ts" .planning/codebase/TESTING.md   # Should be > 0
   grep -c "e2e.test.ts" .planning/codebase/TESTING.md   # Should be > 0
   ```
</verification>

<success_criteria>
- [ ] packages/db/src/connection.int.test.ts exists (renamed from .integration.test.ts)
- [ ] apps/web/tests/e2e/home.e2e.test.ts exists (renamed from .spec.ts)
- [ ] Old test files no longer exist
- [ ] vitest.config.ts excludes `**/*.int.test.ts`
- [ ] vitest.integration.config.ts includes `*.int.test.ts`
- [ ] playwright.config.ts has `testMatch: "**/*.e2e.test.ts"`
- [ ] packages/db/vitest.config.ts excludes `**/*.int.test.ts`
- [ ] TESTING.md documents new convention
- [ ] STATE.md documents new convention
- [ ] pnpm test:unit passes
</success_criteria>

<output>
After completion, create `.planning/phases/01.1-test-file-convention-migration/01.1-01-SUMMARY.md`
</output>
