---
phase: 03-core-consolidation
plan: 05
type: execute
wave: 4
depends_on: ["03-04"]
files_modified:
  - package.json
  - packages/core/src/drizzle/connection.int.test.ts
autonomous: true

must_haves:
  truths:
    - "packages/db directory is deleted"
    - "packages/auth directory is deleted"
    - "Root db:* scripts point to @gemhog/core"
    - "Integration test verifies database connection"
    - "All verification commands pass"
  artifacts:
    - path: "package.json"
      provides: "Updated root scripts for @gemhog/core"
      contains: "@gemhog/core"
    - path: "packages/core/src/drizzle/connection.int.test.ts"
      provides: "Database connection integration test"
      contains: "describe"
  key_links:
    - from: "package.json"
      to: "packages/core"
      via: "pnpm --filter @gemhog/core"
      pattern: "@gemhog/core"
---

<objective>
Delete old packages and update root scripts

Purpose: Complete the migration by removing packages/db and packages/auth, updating root package.json scripts to reference @gemhog/core, and verifying the full test suite passes.

Output: Clean monorepo with only packages/core, all scripts working, all tests passing.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-core-consolidation/03-CONTEXT.md

# Root package.json to update
@package.json

# Integration test to migrate
@packages/db/src/connection.int.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate integration test and delete old packages</name>
  <files>
    packages/core/src/drizzle/connection.int.test.ts
  </files>
  <action>
1. **Migrate integration test** from packages/db to packages/core:
   - Copy packages/db/src/connection.int.test.ts to packages/core/src/drizzle/connection.int.test.ts
   - The test content remains the same — it tests raw database connection
   - Update import paths if needed (the test uses direct drizzle-orm imports, not package imports)

2. **Delete packages/db directory**:
   ```bash
   rm -rf packages/db
   ```

3. **Delete packages/auth directory**:
   ```bash
   rm -rf packages/auth
   ```

Note: Use `rm -rf` — these directories are fully migrated and no longer needed.
  </action>
  <verify>
    - packages/core/src/drizzle/connection.int.test.ts exists
    - packages/db directory does NOT exist
    - packages/auth directory does NOT exist
  </verify>
  <done>Old packages deleted, integration test migrated</done>
</task>

<task type="auto">
  <name>Task 2: Update root package.json scripts</name>
  <files>
    package.json
  </files>
  <action>
Update root package.json db:* scripts to use @gemhog/core:

```json
{
  "scripts": {
    "db:push": "pnpm --filter @gemhog/core db:push",
    "db:studio": "pnpm --filter @gemhog/core db:studio",
    "db:generate": "pnpm --filter @gemhog/core db:generate",
    "db:migrate": "pnpm --filter @gemhog/core db:migrate",
    "db:start": "pnpm --filter @gemhog/core db:start",
    "db:watch": "pnpm --filter @gemhog/core db:watch",
    "db:stop": "pnpm --filter @gemhog/core db:stop",
    "db:down": "pnpm --filter @gemhog/core db:down"
  }
}
```

Change all `@gemhog/db` references to `@gemhog/core`.

All other scripts remain unchanged.
  </action>
  <verify>
    - root package.json db:* scripts reference @gemhog/core
    - No references to @gemhog/db in root package.json
  </verify>
  <done>Root scripts updated to use @gemhog/core</done>
</task>

<task type="auto">
  <name>Task 3: Run full verification suite</name>
  <files></files>
  <action>
Run the complete verification pipeline to ensure everything works:

1. **Reinstall dependencies** (workspace topology changed):
   ```bash
   pnpm install
   ```

2. **Run static analysis**:
   ```bash
   pnpm check
   ```

3. **Run type checking**:
   ```bash
   pnpm check-types
   ```

4. **Run unit tests**:
   ```bash
   pnpm test:unit
   ```

5. **Run integration tests** (requires Docker):
   ```bash
   pnpm db:start && pnpm test:integration
   ```

6. **Verify no references to old packages remain**:
   ```bash
   grep -r "@gemhog/db\|@gemhog/auth" --include="*.ts" --include="*.json" apps/ packages/ | grep -v node_modules || echo "Clean"
   ```

Fix any issues discovered during verification.
  </action>
  <verify>
    - `pnpm install` succeeds
    - `pnpm check-types` passes
    - `pnpm test:unit` passes
    - `pnpm test:integration` passes (with Docker running)
    - No references to @gemhog/db or @gemhog/auth remain
  </verify>
  <done>Full verification suite passes, migration complete</done>
</task>

</tasks>

<verification>
1. packages/db and packages/auth directories no longer exist
2. packages/core is the only database/auth package
3. Root db:* scripts work with @gemhog/core
4. All test suites pass (unit and integration)
5. pnpm check-types passes
6. No orphaned references to old packages
</verification>

<success_criteria>
- packages/db deleted
- packages/auth deleted
- Root scripts use @gemhog/core
- pnpm verify:commit passes
- Integration test passes with Docker
- Migration complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-consolidation/03-05-SUMMARY.md`
</output>
