---
phase: 03.1-code-review-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/core/src/payment/payment.service.ts
  - packages/core/src/payment/payment.mock.ts
  - packages/core/src/payment/payment.test.ts
  - packages/core/src/payment/index.ts
  - packages/core/package.json
autonomous: true

must_haves:
  truths:
    - "PaymentService, PaymentLive, polarClient, getPolarClient are removed"
    - "packages/core/src/payment/ directory only contains error types if any"
    - "@gemhog/core/payment subpath export is removed or simplified"
  artifacts:
    - path: "packages/core/src/payment/index.ts"
      provides: "Minimal payment exports (errors only if any)"
      min_lines: 1
  key_links:
    - from: "packages/core/package.json"
      to: "exports"
      via: "package.json exports field"
      pattern: "./payment"
---

<objective>
Remove dead payment service code

Purpose: PaymentService, PaymentLive, polarClient, getPolarClient are not used anywhere. Polar integration is handled inline in auth.service.ts via better-auth plugin.
Output: Cleaned up packages/core/src/payment/ with only necessary files
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Files to analyze
@packages/core/src/payment/index.ts
@packages/core/src/payment/payment.service.ts
@packages/core/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove dead payment service files</name>
  <files>
    packages/core/src/payment/payment.service.ts
    packages/core/src/payment/payment.mock.ts
    packages/core/src/payment/payment.test.ts
  </files>
  <action>
1. Delete the following files (they are not imported anywhere except their own tests):
   - packages/core/src/payment/payment.service.ts
   - packages/core/src/payment/payment.mock.ts
   - packages/core/src/payment/payment.test.ts

2. Check if payment.errors.ts is used anywhere:
   ```bash
   grep -r "PaymentError" packages/ apps/ --include="*.ts" | grep -v payment.errors.ts
   ```

   If NOT used: delete packages/core/src/payment/payment.errors.ts too

3. Update packages/core/src/payment/index.ts:
   - If only errors remain: export only errors
   - If nothing remains: delete the entire payment/ directory

4. If payment/ directory deleted, update packages/core/package.json:
   - Remove "./payment" from exports field
  </action>
  <verify>
- ls packages/core/src/payment/ shows only index.ts and payment.errors.ts (or directory deleted)
- grep -r "PaymentService" packages/core/src/ returns no results
- grep -r "PaymentLive" packages/core/src/ returns no results
- pnpm check-types passes
  </verify>
  <done>Dead payment service code removed, types still pass</done>
</task>

<task type="auto">
  <name>Task 2: Verify no broken imports</name>
  <files>None (verification only)</files>
  <action>
1. Run full type check:
   ```bash
   pnpm check-types
   ```

2. Run unit tests (should pass - we only removed unused code):
   ```bash
   pnpm test:unit
   ```

3. If any failures, they indicate the code WAS used somewhere. Fix by:
   - Checking the error message for which file imports payment
   - Removing that import since payment is dead code
  </action>
  <verify>
- pnpm check-types exits 0
- pnpm test:unit passes
  </verify>
  <done>No broken imports, all tests pass</done>
</task>

</tasks>

<verification>
```bash
# No PaymentService/PaymentLive references
grep -r "PaymentService\|PaymentLive\|polarClient\|getPolarClient" packages/ apps/ --include="*.ts" | grep -v node_modules

# Types pass
pnpm check-types

# Unit tests pass
pnpm test:unit
```
</verification>

<success_criteria>
- packages/core/src/payment/ has no service code (only errors if used)
- No broken imports
- pnpm check-types passes
- pnpm test:unit passes
</success_criteria>

<output>
After completion, create `.planning/phases/03.1-code-review-fixes/03.1-02-SUMMARY.md`
</output>
