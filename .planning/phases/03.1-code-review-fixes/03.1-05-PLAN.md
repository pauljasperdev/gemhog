---
phase: 03.1-code-review-fixes
plan: 05
type: execute
wave: 3
depends_on:
  - "03.1-02"
  - "03.1-03"
  - "03.1-04"
files_modified:
  - packages/core/package.json
  - packages/api/package.json
  - apps/web/package.json
  - apps/server/package.json
autonomous: true

must_haves:
  truths:
    - "dotenv only exists in packages/env"
    - "No unused dependencies in any package"
    - "pnpm install succeeds without errors"
  artifacts:
    - path: "packages/env/package.json"
      provides: "Only package with dotenv dependency"
      contains: "dotenv"
  key_links:
    - from: "packages/core/package.json"
      to: "dependencies"
      via: "package.json"
      pattern: "dependencies"
---

<objective>
Audit and remove unused dependencies

Purpose: After removing payment service and t3-env, clean up unused dependencies
across the monorepo. Only packages/env should have dotenv. Output: Lean
dependency trees in all packages </objective>

<execution_context> @~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md </execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Package files to audit

@packages/core/package.json @packages/env/package.json
@packages/api/package.json </context>

<tasks>

<task type="auto">
  <name>Task 1: Remove known unused dependencies</name>
  <files>
    packages/core/package.json
    packages/api/package.json
    apps/web/package.json
    apps/server/package.json
  </files>
  <action>
1. Remove dotenv from packages/core/package.json:
   - After drizzle.config.ts fix, dotenv is no longer needed
   - Only packages/env should have dotenv

2. Check packages/api/package.json for dotenv:
   - Remove if present (should use @gemhog/env)

3. Check apps/web/package.json for dotenv:
   - Remove if present (should use @gemhog/env)

4. Check apps/server/package.json for dotenv:
   - Remove if present (should use @gemhog/env)

5. Remove zod from packages/core/package.json if present:
   - After Effect Config migration, zod is not needed

6. Run pnpm install to update lockfile:
   ```bash
   pnpm install
   ```
   </action>
   <verify>

- grep "dotenv" packages/core/package.json returns no results
- grep "dotenv" packages/api/package.json returns no results
- grep "dotenv" packages/env/package.json returns match (this is expected)
- pnpm install succeeds </verify> <done>Known unused dependencies removed,
  lockfile updated</done> </task>

<task type="auto">
  <name>Task 2: Run knip for comprehensive audit</name>
  <files>None (audit only, changes via Task 3)</files>
  <action>
1. Run knip from repo root:
   ```bash
   npx knip
   ```

2. Review output for:
   - Unused dependencies (can be removed)
   - Unused devDependencies (can be removed)
   - Unused exports (code that can be removed)
   - Unused files (can be deleted)

3. Document findings for next task. Note any false positives:
   - Peer dependencies (may appear unused)
   - Plugin dependencies (used implicitly)
   - Type-only imports (may not be detected)

4. If knip reports many issues, focus on dependencies only for this plan.
   File/export cleanup can be a separate plan if needed. </action> <verify>

- npx knip runs without errors
- Output reviewed and understood </verify> <done>knip audit complete, findings
  documented</done> </task>

<task type="auto">
  <name>Task 3: Remove confirmed unused dependencies</name>
  <files>
    packages/core/package.json
    packages/api/package.json
    packages/env/package.json
    apps/web/package.json
    apps/server/package.json
  </files>
  <action>
1. For each unused dependency reported by knip:
   - Verify it's truly unused (check imports, configs)
   - Remove from package.json

2. Be careful with:
   - TypeScript/type definitions (@types/\*) - may be needed even if not
     directly imported
   - Build tools (vite, drizzle-kit, etc.) - used by scripts
   - Peer dependencies - required by other packages

3. After all removals, run:

   ```bash
   pnpm install
   pnpm check-types
   pnpm test:unit
   ```

4. If anything breaks, add the dependency back and note it as a false positive.
   </action> <verify>

- pnpm install succeeds
- pnpm check-types passes
- pnpm test:unit passes </verify> <done>Confirmed unused dependencies removed,
  project still works</done> </task>

</tasks>

<verification>
```bash
# Only packages/env has dotenv
grep -r '"dotenv"' packages/*/package.json apps/*/package.json | grep -v packages/env

# Install and test

pnpm install && pnpm check-types && pnpm test:unit

# Full verification

pnpm verify

```
</verification>

<success_criteria>
- dotenv only in packages/env
- No unused dependencies in any package
- pnpm install succeeds
- pnpm verify passes
</success_criteria>

<output>
After completion, create `.planning/phases/03.1-code-review-fixes/03.1-05-SUMMARY.md`
</output>
```
