---
phase: 03.1-code-review-fixes
plan: 05
subsystem: infra
tags: [dependencies, knip, pnpm, monorepo]

# Dependency graph
requires:
  - phase: 03.1-03
    provides: Effect Config migration (removed t3-env, zod from env)
  - phase: 03.1-04
    provides: Auth simplification (removed Effect wrapper)
provides:
  - Lean dependency trees in all packages
  - Only packages/env has dotenv for env loading
  - Removed unused @effect/vitest after auth simplification
affects: [future-dependency-audits, package-maintenance]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Central dotenv in packages/env
    - Transitive dependencies via @gemhog/core

key-files:
  created: []
  modified:
    - packages/core/package.json
    - packages/api/package.json
    - apps/web/package.json
    - apps/server/package.json

key-decisions:
  - "Keep dotenv in packages/core for drizzle.config.ts (per decision 03.1-03)"
  - "Remove @effect/vitest (unused after auth simplification in 03.1-04)"
  - "Remove transitive deps from consumers (better-auth, zod via @gemhog/core)"

patterns-established:
  - "Packages should not duplicate dependencies available transitively via
    workspace packages"
  - "Use knip for periodic dependency audits"

# Metrics
duration: 4min
completed: 2026-01-21
---

# Phase 3.1 Plan 05: Audit and Remove Unused Dependencies Summary

**Removed 9 unused dependencies identified by knip audit, reduced node_modules
footprint**

## Performance

- **Duration:** 4 min
- **Started:** 2026-01-21T09:31:42Z
- **Completed:** 2026-01-21T09:36:03Z
- **Tasks:** 3
- **Files modified:** 5 (4 package.json + pnpm-lock.yaml)

## Accomplishments

- Removed dotenv from packages/api, apps/web, apps/server (use @gemhog/env
  instead)
- Removed zod from packages/core (unused after Effect Config migration)
- Removed better-auth from apps/server (uses via @gemhog/core/auth)
- Removed @gemhog/env, @trpc/client, zod from packages/api (unused)
- Removed @effect/vitest from packages/core (unused after auth simplification)
- Ran knip audit to identify all unused dependencies

## Task Commits

Each task was committed atomically:

1. **Task 1: Remove known unused dependencies** - `d2a0819` (chore)
2. **Task 2: Run knip for comprehensive audit** - no commit (audit only)
3. **Task 3: Remove confirmed unused dependencies** - `5ed6e14` (chore)

## Files Created/Modified

- `packages/core/package.json` - Removed zod, @effect/vitest
- `packages/api/package.json` - Removed dotenv, @gemhog/env, @trpc/client, zod
- `apps/web/package.json` - Removed dotenv
- `apps/server/package.json` - Removed dotenv, better-auth
- `pnpm-lock.yaml` - Updated lockfile

## Decisions Made

1. **Keep dotenv in packages/core** - drizzle.config.ts uses dotenv directly
   (established in 03.1-03) because drizzle-kit only needs DATABASE_URL but
   @gemhog/env validates ALL server env vars
2. **Remove @effect/vitest** - No longer used after auth simplification removed
   Effect Context.Tag and Layer patterns
3. **Leave root package.json dependencies** - Catalog entries for pnpm
   workspace, not direct usage

## Deviations from Plan

### Plan Expected vs Actual

**Plan expected:** "dotenv only exists in packages/env" **Actual:** dotenv also
in packages/core (intentional per prior decision 03.1-03)

This is not a bug - it follows the decision made in plan 03.1-03 to use dotenv
directly in drizzle.config.ts. The plan was written before knowing that decision
would be made.

---

**Total deviations:** 1 (plan expectation based on outdated assumption) **Impact
on plan:** None - prior decision was correct and should be maintained

## Issues Encountered

None - knip audit ran successfully and dependency removals verified with pnpm
check-types and pnpm test:unit.

## Knip Audit Findings

**Unused dependencies removed (9):**

- dotenv: packages/api, apps/web, apps/server
- zod: packages/core, packages/api
- better-auth: apps/server
- @gemhog/env: packages/api
- @trpc/client: packages/api
- @effect/vitest: packages/core

**False positives noted (not removed):**

- Root package.json catalog entries (workspace configuration)
- @gemhog/config in apps/web (consistency with other packages)

**Unused files reported but not cleaned (future work):**

- apps/web/src/components/ui/card.tsx
- apps/web/src/components/ui/checkbox.tsx
- packages/env/src/native.ts

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Phase 3.1 complete - all 5 plans executed
- All code review fixes addressed
- Ready to continue with Phase 4

---

_Phase: 03.1-code-review-fixes_ _Completed: 2026-01-21_
