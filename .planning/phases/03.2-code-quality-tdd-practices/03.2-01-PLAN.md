---
phase: 03.2-code-quality-tdd-practices
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/server/src/index.ts
  - packages/core/src/drizzle/errors.ts
autonomous: true

must_haves:
  truths:
    - "No SEC-fix archaeological comments in apps/server/src/index.ts"
    - "No unused DatabaseError/ConnectionError classes in errors.ts"
  artifacts:
    - path: "apps/server/src/index.ts"
      provides: "Clean AI endpoint without archaeological comments"
      contains_not: "SEC-001 fix|SEC-002 fix"
    - path: "packages/core/src/drizzle/errors.ts"
      provides: "Only used error classes"
      exists: false
  key_links: []
---

<objective>
Remove dead code and archaeological comments from the codebase.

Purpose: Clean up code quality issues identified in CODE_REVIEW.md -
specifically removing SEC-fix reference comments and unused error classes that
were created "for later" but never used.

Output: Clean `apps/server/src/index.ts` without historical comments, and
`packages/core/src/drizzle/errors.ts` file deleted (classes are unused).
</objective>

<execution_context> @~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md </execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/CONVENTIONS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove archaeological comments from apps/server/src/index.ts</name>
  <files>apps/server/src/index.ts</files>
  <action>
Remove all archaeological comments that reference historical fixes rather than explaining current purpose.

Specifically remove these comments:

- Line 15: `// Schema for AI message validation (SEC-001 fix)` - replace with
  purpose-focused comment or remove entirely
- Line 16: `// Validates the UI message parts structure used by AI SDK v6` -
  this is acceptable (explains what), can keep
- Line 28: `// Allow other part types to pass through (reasoning, tool, etc.)` -
  acceptable, keep
- Line 55: `// Simple in-memory rate limiter (SEC-002 fix)` - remove "(SEC-001
  fix)" part
- Line 56:
  `// For production with multiple servers, use Redis-based rate limiting` -
  acceptable, keep
- Line 114: `// Rate limiting (SEC-002 fix)` - remove "(SEC-002 fix)" part
- Line 115: `// Use IP as identifier (or session ID if authenticated)` -
  acceptable, keep
- Line 124: `// Validate input (SEC-001 fix)` - remove "(SEC-001 fix)" part

Rule: Keep comments that explain WHY or WHAT for current readers. Remove
references to historical ticket numbers (SEC-001, SEC-002).

After changes, comments should explain the current purpose without referencing
past issues. </action> <verify> Run:
`grep -E "SEC-[0-9]+" apps/server/src/index.ts` - should return no results Run:
`pnpm check` - should pass (no formatting/lint issues introduced) </verify>
<done>No archaeological SEC-fix comments remain in
apps/server/src/index.ts</done> </task>

<task type="auto">
  <name>Task 2: Delete unused error classes from packages/core/src/drizzle/errors.ts</name>
  <files>packages/core/src/drizzle/errors.ts</files>
  <action>
Delete the entire `packages/core/src/drizzle/errors.ts` file.

Reason: Both `DatabaseError` and `ConnectionError` classes are defined but never
imported or used anywhere in the codebase. These were created speculatively
during Effect setup but never consumed.

Verification before deletion (already done in CODE_REVIEW.md):

- `grep -r "DatabaseError" --include="*.ts" packages/` shows no imports
- `grep -r "ConnectionError" --include="*.ts" packages/` shows no imports

After deletion:

1. Check if errors.ts is exported from packages/core - if so, remove that export
2. Run type check to ensure nothing breaks </action> <verify> Run:
   `ls packages/core/src/drizzle/errors.ts` - should fail (file not found) Run:
   `pnpm check-types` - should pass (no broken imports) </verify>
   <done>packages/core/src/drizzle/errors.ts file deleted and no broken
   references</done> </task>

</tasks>

<verification>
After both tasks:
1. `grep -rE "SEC-[0-9]+" apps/server/` returns empty
2. `ls packages/core/src/drizzle/errors.ts` fails (file not found)
3. `pnpm check-types` passes
4. `pnpm check` passes
</verification>

<success_criteria>

- No SEC-fix archaeological comments in apps/server/src/index.ts
- packages/core/src/drizzle/errors.ts deleted
- All type checks pass
- No orphaned imports or exports </success_criteria>

<output>
After completion, create `.planning/phases/03.2-code-quality-tdd-practices/03.2-01-SUMMARY.md`
</output>
