---
phase: 03.2-code-quality-tdd-practices
plan: 03
subsystem: testing
tags: [playwright, e2e, fixtures, error-detection, tdd]

# Dependency graph
requires:
  - phase: 01-testing-infrastructure
    provides: E2E test setup with Playwright
provides:
  - Error-detecting Playwright test fixture
  - E2E tests that fail on runtime errors
affects: [future-e2e-tests, app-quality]

# Tech tracking
tech-stack:
  added: []
  patterns: [playwright-fixtures, error-detection-in-e2e]

key-files:
  created:
    - apps/web/tests/e2e/fixtures.ts
  modified:
    - apps/web/tests/e2e/home.e2e.test.ts
    - packages/env/src/web.ts
    - packages/env/src/web.test.ts

key-decisions:
  - "E2E tests use extended Playwright fixture for error detection"
  - "Capture console.error and page exceptions, fail test if errors found"
  - "Use direct process.env for NEXT_PUBLIC_* vars (Next.js inlines at build
    time)"

patterns-established:
  - "All E2E tests import from ./fixtures, not @playwright/test"
  - "TDD: Tests fail when app has errors - fix app, not test"

# Metrics
duration: 3min
completed: 2026-01-21
---

# Phase 3.2 Plan 03: E2E Error Detection Fixture Summary

**Playwright test fixture that captures page errors and console.error, causing
E2E tests to fail when app has runtime errors**

## Performance

- **Duration:** 3 min
- **Started:** 2026-01-21T19:20:03Z
- **Completed:** 2026-01-21T19:22:36Z
- **Tasks:** 2 (Task 1 was already completed by previous agent)
- **Files modified:** 2

## Accomplishments

- Extended Playwright test fixture with automatic error detection
- E2E tests now fail when page has JavaScript exceptions
- E2E tests now fail when page logs console.error messages
- Fixed packages/env/src/web.ts to work with Next.js build-time env inlining
- All E2E tests now pass

## Task Commits

Each task was committed atomically:

1. **Task 1: Create Playwright test fixture with error detection** - `ed551fc`
   (previously completed in 03.2-01)
2. **Task 2: Update E2E tests to use error-detecting fixture** - `83ff640`
   (feat)

## Files Created/Modified

- `apps/web/tests/e2e/fixtures.ts` - Extended Playwright test with error capture
  (33 lines)
- `apps/web/tests/e2e/home.e2e.test.ts` - Updated to import from ./fixtures

## Decisions Made

- **Import order:** `{ expect, test }` to satisfy Biome import sorting rules
- **No error filtering:** Start strict, only add filtering if false positives
  appear in practice

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Fixed packages/env/src/web.ts Effect Config
incompatibility**

- **Found during:** Task 2 verification (E2E test run)
- **Issue:** Effect Config tries to read process.env at runtime, but Next.js
  inlines NEXT*PUBLIC*\* values at build time. The browser can't read
  process.env dynamically.
- **Fix:** Replaced Effect Config with direct process.env access, which Next.js
  replaces with literal values during build
- **Files modified:** packages/env/src/web.ts, packages/env/src/web.test.ts
- **Verification:** E2E tests pass, unit tests pass
- **Committed in:** 222b7c2 (style fix batch)

---

**Total deviations:** 1 auto-fixed (Rule 1 - Bug) **Impact on plan:** Essential
fix for E2E tests to pass. The error-detecting fixture correctly identified this
real bug.

## Issues Encountered

None - the deviation above was the only issue and was auto-fixed.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Error-detecting fixture ready for all future E2E tests
- New E2E tests should import `{ expect, test }` from `./fixtures`
- All E2E tests pass

---

_Phase: 03.2-code-quality-tdd-practices_ _Completed: 2026-01-21_
