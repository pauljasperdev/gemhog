---
phase: 03.2-code-quality-tdd-practices
plan: 03
subsystem: testing
tags: [playwright, e2e, fixtures, error-detection, tdd]

# Dependency graph
requires:
  - phase: 01-testing-infrastructure
    provides: E2E test setup with Playwright
provides:
  - Error-detecting Playwright test fixture
  - E2E tests that fail on runtime errors
affects: [future-e2e-tests, app-quality]

# Tech tracking
tech-stack:
  added: []
  patterns: [playwright-fixtures, error-detection-in-e2e]

key-files:
  created:
    - apps/web/tests/e2e/fixtures.ts
  modified:
    - apps/web/tests/e2e/home.e2e.test.ts

key-decisions:
  - "E2E tests use extended Playwright fixture for error detection"
  - "Capture console.error and page exceptions, fail test if errors found"

patterns-established:
  - "All E2E tests import from ./fixtures, not @playwright/test"
  - "TDD: Tests fail when app has errors - fix app, not test"

# Metrics
duration: 3min
completed: 2026-01-21
---

# Phase 3.2 Plan 03: E2E Error Detection Fixture Summary

**Playwright test fixture that captures page errors and console.error, causing E2E tests to fail when app has runtime errors**

## Performance

- **Duration:** 3 min
- **Started:** 2026-01-21T19:20:03Z
- **Completed:** 2026-01-21T19:22:36Z
- **Tasks:** 2 (Task 1 was already completed by previous agent)
- **Files modified:** 2

## Accomplishments

- Extended Playwright test fixture with automatic error detection
- E2E tests now fail when page has JavaScript exceptions
- E2E tests now fail when page logs console.error messages
- Tests correctly identified missing NEXT_PUBLIC_SERVER_URL (real app error)

## Task Commits

Each task was committed atomically:

1. **Task 1: Create Playwright test fixture with error detection** - `ed551fc` (previously completed in 03.2-01)
2. **Task 2: Update E2E tests to use error-detecting fixture** - `83ff640` (feat)

## Files Created/Modified

- `apps/web/tests/e2e/fixtures.ts` - Extended Playwright test with error capture (33 lines)
- `apps/web/tests/e2e/home.e2e.test.ts` - Updated to import from ./fixtures

## Decisions Made

- **Import order:** `{ expect, test }` to satisfy Biome import sorting rules
- **No error filtering:** Start strict, only add filtering if false positives appear in practice

## Deviations from Plan

None - plan executed exactly as written.

**Note on Task 1:** The fixtures.ts file was already created by a previous agent execution (03.2-01). This plan verified the file exists and matches requirements, then proceeded to Task 2.

## Issues Encountered

**E2E tests now fail (expected TDD behavior):**

The tests are failing with this error:
```
[page] (Missing data at NEXT_PUBLIC_SERVER_URL: "Expected NEXT_PUBLIC_SERVER_URL to exist in the process context")
```

This is **correct behavior** - the fixture is working as designed. It detected a real runtime error that URL-only tests would miss. The error occurs because:

1. Next.js `NEXT_PUBLIC_*` env vars must be available at build time
2. The Playwright config sets it at runtime for the web server process
3. But the built app doesn't have it inlined

**Resolution:** This is an existing app configuration issue, not a test issue. The fix belongs in application code or build configuration, not in the test fixture. This demonstrates the value of the error-detecting fixture.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Error-detecting fixture ready for all future E2E tests
- New E2E tests should import `{ expect, test }` from `./fixtures`
- App env configuration issue needs to be addressed separately (not in this plan scope)

---
*Phase: 03.2-code-quality-tdd-practices*
*Completed: 2026-01-21*
