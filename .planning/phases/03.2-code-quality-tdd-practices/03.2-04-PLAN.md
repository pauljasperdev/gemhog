---
phase: 03.2-code-quality-tdd-practices
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/codebase/TESTING.md
  - .planning/codebase/CONVENTIONS.md
autonomous: true

must_haves:
  truths:
    - "TESTING.md documents TDD workflow (red-green-refactor)"
    - "TESTING.md explains why 'red first' matters"
    - "CONVENTIONS.md documents comment standards"
    - "CONVENTIONS.md explains archaeological comments anti-pattern"
  artifacts:
    - path: ".planning/codebase/TESTING.md"
      provides: "TDD practices section"
      contains: "Red-Green-Refactor|red first"
    - path: ".planning/codebase/CONVENTIONS.md"
      provides: "Comment standards section"
      contains: "archaeological|WHY.*not.*WHAT"
  key_links: []
---

<objective>
Update documentation with TDD practices and comment standards.

Purpose: Codify the TDD workflow and comment standards so future development follows consistent practices. This addresses CODE_REVIEW.md findings about missing guidance for writing tests and comments.

Output: Updated TESTING.md with TDD section, updated CONVENTIONS.md with comment standards section.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.2-code-quality-tdd-practices/03.2-RESEARCH.md
@.planning/codebase/TESTING.md
@.planning/codebase/CONVENTIONS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add TDD practices section to TESTING.md</name>
  <files>.planning/codebase/TESTING.md</files>
  <action>
Add a new section to TESTING.md documenting TDD workflow.

Insert after the "Test Patterns" section (or before "What to Mock" section).

Content from RESEARCH.md:

```markdown
## TDD Workflow: Red-Green-Refactor

Test-Driven Development follows a strict cycle:

1. **RED**: Write a failing test that describes the behavior you want
2. **GREEN**: Write the minimum code to make the test pass
3. **REFACTOR**: Clean up while keeping tests green

### Why "Red First" Matters

- **Proves the test works**: A test that never fails might not test anything
- **Forces interface design**: Think about how code will be used before implementing
- **Creates living documentation**: Tests describe expected behavior

### TDD Workflow Example

```bash
# 1. Write the test (it should fail)
pnpm test:unit -- --run src/feature.test.ts
# Expected: FAIL - feature not implemented yet

# 2. Implement the feature
# ... write code ...

# 3. Run test again (it should pass)
pnpm test:unit -- --run src/feature.test.ts
# Expected: PASS

# 4. Refactor if needed, keep tests green
```

### When to Use TDD

**Good candidates for TDD:**
- Business logic with defined inputs/outputs
- API endpoints with request/response contracts
- Data transformations, parsing, formatting
- Validation rules

**Skip TDD for:**
- UI layout and styling
- Configuration changes
- Simple CRUD with no business logic
- One-off scripts
```

Preserve all existing content - only add the new section.
  </action>
  <verify>
Check: `grep "Red-Green-Refactor" .planning/codebase/TESTING.md` returns a match
Check: `grep "red first" .planning/codebase/TESTING.md` returns a match (case insensitive)
  </verify>
  <done>TESTING.md has TDD practices section</done>
</task>

<task type="auto">
  <name>Task 2: Add comment standards section to CONVENTIONS.md</name>
  <files>.planning/codebase/CONVENTIONS.md</files>
  <action>
Update the existing "Comments" section in CONVENTIONS.md with specific standards.

The current section (around line 109-125) is minimal. Expand it with concrete guidance.

Replace the current Comments section with:

```markdown
## Comments

### When to Comment

**DO comment:**
- Non-obvious business logic (explain the WHY)
- Complex algorithms (explain the approach)
- Security-critical code (explain the threat model)
- Workarounds for external bugs (link to issue)

**DON'T comment:**
- Self-explanatory code
- What the code does (the code shows that)
- Historical references (use git history)

### Comment Quality Standards

**Explain WHY, not WHAT:**

```typescript
// BAD: Restates the code
// Validate input
const result = schema.parse(input);

// GOOD: Explains the purpose
// Prevent injection attacks - user input must match expected schema
const result = schema.parse(input);
```

**Avoid archaeological comments:**

Archaeological comments reference historical context rather than explaining current purpose. They become stale and confusing.

```typescript
// BAD: References past tickets/fixes
// SEC-001 fix
// Removed in refactor #123
// TODO: cleanup after v2 migration

// GOOD: Explains current purpose (or remove if self-explanatory)
// Rate limiting prevents abuse of expensive AI operations
```

**Link to issues for workarounds:**

```typescript
// BAD: Unexplained workaround
// @ts-ignore - doesn't work without this

// GOOD: Links to context
// Workaround for Next.js hydration bug: https://github.com/vercel/next.js/issues/12345
// @ts-ignore - server/client mismatch in dev mode only
```

### JSDoc/TSDoc

Not widely used in this codebase. Self-documenting code with TypeScript types is preferred. Use JSDoc only for:
- Public library APIs
- Complex function signatures that benefit from inline documentation
```

Preserve all other sections of CONVENTIONS.md.
  </action>
  <verify>
Check: `grep "archaeological" .planning/codebase/CONVENTIONS.md` returns a match
Check: `grep "WHY.*not.*WHAT" .planning/codebase/CONVENTIONS.md` or similar pattern exists
  </verify>
  <done>CONVENTIONS.md has comment standards section with archaeological anti-pattern</done>
</task>

</tasks>

<verification>
After both tasks:
1. TESTING.md contains "Red-Green-Refactor" and explains TDD workflow
2. CONVENTIONS.md contains "archaeological" and explains comment standards
3. Both files are valid markdown (no formatting errors)
4. `pnpm format:md` runs without errors (if available)
</verification>

<success_criteria>
- TESTING.md has TDD section explaining red-green-refactor
- CONVENTIONS.md has comment standards explaining WHY vs WHAT
- CONVENTIONS.md documents archaeological comments anti-pattern
- Documentation is actionable (examples, not just principles)
</success_criteria>

<output>
After completion, create `.planning/phases/03.2-code-quality-tdd-practices/03.2-04-SUMMARY.md`
</output>
