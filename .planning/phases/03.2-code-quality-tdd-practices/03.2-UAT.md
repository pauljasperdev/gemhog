---
status: diagnosed
phase: 03.2-code-quality-tdd-practices
source: 03.2-01-PLAN.md, 03.2-02-PLAN.md, 03.2-03-PLAN.md, 03.2-04-PLAN.md, 03.2-05-PLAN.md
started: 2026-01-22T00:00:00Z
updated: 2026-01-22T00:06:00Z
---

## Current Test

[testing complete]

## Tests

### 1. No archaeological SEC-fix comments in server code
expected: Run `grep -rE "SEC-[0-9]+" apps/server/` returns no matches
result: pass

### 2. Unused error classes removed
expected: `ls packages/core/src/drizzle/errors.ts` fails (file not found)
result: pass

### 3. Server env schema validation tests exist
expected: `pnpm test:unit -- --run packages/env/src/server.test.ts` runs tests that pass
result: pass

### 4. Web env schema validation tests exist
expected: `pnpm test:unit -- --run packages/env/src/web.test.ts` runs tests that pass
result: pass

### 5. E2E tests use error-detecting fixture
expected: `apps/web/tests/e2e/home.e2e.test.ts` imports from "./fixtures" not "@playwright/test"
result: pass

### 6. E2E fixture captures page errors
expected: `apps/web/tests/e2e/fixtures.ts` exists and exports test/expect with error detection
result: issue
reported: "in @packages/env/src/web.ts was effect removed. i did not want that."
severity: major

### 7. TESTING.md documents TDD workflow
expected: `grep "Red-Green-Refactor" .planning/codebase/TESTING.md` returns a match
result: pass

### 8. CONVENTIONS.md documents comment standards
expected: `grep "archaeological" .planning/codebase/CONVENTIONS.md` returns a match
result: pass

### 9. Server startup integration tests exist
expected: `pnpm test:integration -- --run apps/server/src/startup.int.test.ts` runs and passes
result: pass

### 10. Web startup integration tests exist
expected: `pnpm test:integration -- --run apps/web/startup.int.test.ts` runs and passes
result: pass

## Summary

total: 10
passed: 9
issues: 1
pending: 0
skipped: 0

## Gaps

- truth: "packages/env/src/web.ts should use Effect Config like server.ts"
  status: failed
  reason: "User reported: in @packages/env/src/web.ts was effect removed. i did not want that."
  severity: major
  test: 6
  root_cause: "web.ts was changed to use plain function with direct process.env access instead of Effect Config. Comment states Next.js inlines NEXT_PUBLIC_* at build time, making runtime Effect Config incompatible with browser. However, user expected Effect consistency."
  artifacts:
    - path: "packages/env/src/web.ts"
      issue: "Uses plain getEnv() function instead of Effect Config"
    - path: "packages/env/src/server.ts"
      issue: "Reference - correctly uses Effect Config.all with Config.redacted/string"
  missing:
    - "Restore Effect Config usage in web.ts, possibly with server-side validation that exports inlined values"
  debug_session: ""
