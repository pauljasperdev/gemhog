---
phase: 04-sst-deployment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/env/src/server.ts
  - packages/env/src/server.test.ts
  - apps/server/package.json
  - package.json
  - pnpm-lock.yaml
autonomous: true

must_haves:
  truths:
    - "GOOGLE_GENERATIVE_AI_API_KEY is validated at startup"
    - "SST CLI is available via npx sst"
    - "@hono/aws-lambda is installed in apps/server"
  artifacts:
    - path: "packages/env/src/server.ts"
      provides: "GOOGLE_GENERATIVE_AI_API_KEY env validation"
      contains: "GOOGLE_GENERATIVE_AI_API_KEY"
    - path: "apps/server/package.json"
      provides: "@hono/aws-lambda dependency"
      contains: "@hono/aws-lambda"
  key_links:
    - from: "apps/server/src/index.ts"
      to: "packages/env/src/server.ts"
      via: "env import"
      pattern: "@gemhog/env/server"
---

<objective>
Install SST dependencies and fix missing env validation for AI API key.

Purpose: Foundation work enabling SST deployment. The env schema gap was documented in CONCERNS.md - GOOGLE_GENERATIVE_AI_API_KEY is used by apps/server but not validated. Also installs SST CLI and Hono Lambda adapter.

Output: Updated env schema, installed dependencies, passing tests.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-sst-deployment/04-CONTEXT.md
@.planning/phases/04-sst-deployment/04-RESEARCH.md
@.planning/codebase/CONCERNS.md
@packages/env/src/server.ts
@apps/server/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add GOOGLE_GENERATIVE_AI_API_KEY to env validation</name>
  <files>packages/env/src/server.ts, packages/env/src/server.test.ts</files>
  <action>
Update the t3-env server schema to include GOOGLE_GENERATIVE_AI_API_KEY:

1. In `packages/env/src/server.ts`:
   - Add `GOOGLE_GENERATIVE_AI_API_KEY: z.string().min(1)` to the server object
   - This key is used by @ai-sdk/google in apps/server

2. In `packages/env/src/server.test.ts`:
   - Add GOOGLE_GENERATIVE_AI_API_KEY to the mock env in test setup
   - Value can be any non-empty string like "test-google-api-key"

Why: CONCERNS.md documents this as a known gap - "GOOGLE_GENERATIVE_AI_API_KEY not in Zod schema". This ensures fail-fast validation at startup.
  </action>
  <verify>
```bash
# Unit tests pass
pnpm test:unit --filter @gemhog/env

# Type check passes
pnpm check-types
```
  </verify>
  <done>GOOGLE_GENERATIVE_AI_API_KEY is in server env schema, tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Install SST and Hono Lambda dependencies</name>
  <files>apps/server/package.json, package.json, pnpm-lock.yaml</files>
  <action>
Install dependencies for SST deployment:

1. Add SST as devDependency at root (for CLI and infra code):
   ```bash
   pnpm add -D sst
   ```

2. Add @hono/aws-lambda to apps/server (for Lambda handler):
   ```bash
   pnpm --filter server add @hono/aws-lambda
   ```

Note: SST SDK for runtime (`Resource` object) is NOT needed in app code - the constraint is SST-agnostic application code. SST injects env vars at deploy time.
  </action>
  <verify>
```bash
# SST CLI works
pnpm exec sst version

# Dependencies installed correctly
pnpm ls @hono/aws-lambda --filter server
pnpm ls sst
```
  </verify>
  <done>SST ^3.17 installed at root, @hono/aws-lambda installed in apps/server</done>
</task>

</tasks>

<verification>
```bash
# Full verification
pnpm check-types
pnpm test:unit
```
</verification>

<success_criteria>
- GOOGLE_GENERATIVE_AI_API_KEY validated in packages/env/src/server.ts
- Unit tests updated and passing
- SST CLI available (pnpm exec sst version)
- @hono/aws-lambda in apps/server dependencies
</success_criteria>

<output>
After completion, create `.planning/phases/04-sst-deployment/04-01-SUMMARY.md`
</output>
